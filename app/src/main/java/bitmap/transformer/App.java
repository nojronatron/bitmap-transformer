/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package bitmap.transformer;

import java.io.IOException;
import java.nio.file.InvalidPathException;

public class App {
    /**
     * Proof of life method displays input args if there are 3 of them.
     * @param strings Args received by Main.
     * @return String representing received command-line args.
     */
    public static String getGreeting(String[] strings) {
        StringBuilder sb = new StringBuilder();
        sb.append("Inputs received:");

        for (String str : strings) {
            sb.append(" \"").append(str).append("\"");
        }

        sb.append(".");

        return sb.toString();
    }

    public static void displayUsage() {
        System.out.println("Usage: bitmap-transformer inputFilename outputFileName transformName\n");
        System.out.println("**************** Available Transforms ****************");
        System.out.println("*  \"bars\": Put the image in a makeshift jail         *");
        System.out.println("*  \"rotate\": Rotate the image 90 degrees clockwise   *");
        System.out.println("*  \"mirror\" flip left and right sides of image       *");
        System.out.println("******************************************************\n");
    }
    public static void main(String[] args) {
        if (args.length != 3) {
            App.displayUsage();
            return;
        }

        String inFilePath = args[0];
        String outFilePath = args[1];
        String transformCmd = args[2];

        Bitmap bitmap = new Bitmap(inFilePath, outFilePath, transformCmd);

        if (!bitmap.isValidTransformation(transformCmd)) {
            App.displayUsage();
            return;
        }

        if (!bitmap.isFormattedFilePath(inFilePath)) {
            System.out.println("\"inputFilename\" must contain only alpha-numerics, underscore, hyphen, a dot. File type must be PNG.\n");
            return;
        }
        if (!bitmap.isFormattedFilePath(outFilePath)) {
            System.out.println("\"outputFilename\" must contain only alpha-numerics, underscore, hyphen, a dot. File type must be PNG.\n");
            return;
        }

        try {
            bitmap.loadInputFile();
            System.out.println("Read file " + bitmap.getInFilePath() + " successfully.");
        } catch (NullPointerException nullPointer) {
            System.out.println("Unable to read file at " + bitmap.getInFilePath());
            return;
        } catch (IOException inputOutput) {
            System.out.println("A problem occurred while reading " + bitmap.getInFilePath() + ". Is the filename correct?");
            return;
        } catch (InvalidPathException invalidPath) {
            System.out.println(invalidPath.getReason());
            return;
        }

        try {
            bitmap.processTransformation();
            System.out.println("Successfully applied transformation!");
        } catch (IllegalStateException illegalState) {
            System.out.println(illegalState.getMessage());
            return;
        }

        try {
            bitmap.writeOutputFile();
            System.out.println("Wrote changes to file " + bitmap.getOutFilePath());
        } catch (InvalidPathException invalidPath) {
            System.out.println("Unable to create file at " + bitmap.getOutFilePath());
        } catch (IOException inputOutput) {
            System.out.println("Unable to write to file " + bitmap.getOutFilePath());
        }
    }
}
